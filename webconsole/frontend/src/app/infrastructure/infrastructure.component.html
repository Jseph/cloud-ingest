<ng-container *ngIf="showInfrastructureStatusLoading; else infrastructureBody">
  <mat-spinner></mat-spinner>
</ng-container>
<ng-template #infrastructureBody>

  <div class="ingest-error-message" *ngIf="showLoadInfrastructureError; else infrastructureInformation">
    <h2> There was an error getting the infrastructure status </h2>
    <strong> {{ loadInfrastructureErrorTitle }} </strong>
    <pre> {{ loadInfrastructureErrorMessage }} </pre>
  </div>

  <ng-template #infrastructureInformation>
    <mat-card class="ingest-infrastructure-ok" *ngIf="showInfrastructureStatusOk">
      <h2> <mat-icon>check</mat-icon> Cloud Ingest Infrastructure is running as expected. </h2>
      Next steps:
      <ol>
        <li> Download and extract the gsutil worker: <a href="https://storage.googleapis.com/cloud-ingest-pub/gsutil_4.27pre_ing5.tar.gz">tar.gz</a> | <a href="https://storage.googleapis.com/cloud-ingest-pub/gsutil_4.27pre_ing5.zip">zip</a> </li>
        <li> In a shell window navigate to the path where you extracted the gsutil worker. </li>
        <li> Run <code> ./gsutil config </code> and choose {{projectId}} as your default project ID when prompted. </li>
        <li> Run <br/> <code> ./gsutil agent listandcopy \<br/> projects/{{projectId}}/subscriptions/cloud-ingest-list \<br/> projects/{{projectId}}/topics/cloud-ingest-list-progress \<br/> projects/{{projectId}}/subscriptions/cloud-ingest-copy \<br/> projects/{{projectId}}/topics/cloud-ingest-copy-progress
          </code>
        </li>
      </ol>
      Note: On a windows machine, run <code> python ./gsutil.py </code> instead of <code> ./gsutil</code> for the commands above.

    </mat-card>

    <mat-card class="ingest-infrastructure-not-found" *ngIf="showInfrastructureNotFound">
      <h2> <mat-icon>error</mat-icon> Please create infrastructure to start. </h2>
      <!-- TODO(b/65736645): Add a button to deploy the infrastructure. -->
    </mat-card>

    <mat-card class="ingest-infrastructure-deploying" *ngIf="showInfrastructureDeploying">
      <h2> <mat-spinner [diameter]="24" [strokeWidth]="3" class="ingest-inline-spinner"> </mat-spinner> Cloud Ingest Infrastructure deployment is in progress... </h2>
    </mat-card>

    <mat-card class="ingest-infrastructure-deleting" *ngIf="showInfrastructureDeleting">
      <h2> <mat-spinner [diameter]="24" [strokeWidth]="3" class="ingest-inline-spinner"> </mat-spinner> Cloud Ingest Infrastructure tear down is in progress... </h2>
    </mat-card>

    <mat-card class="ingest-infrastructure-failed" *ngIf="showInfrastructureFailed">
      <h2> <mat-icon>error</mat-icon> Something went wrong in the Cloud Ingest Infrastructure.</h2>
      <p> Please tear down and deploy again. </p>
      <!-- TODO(b/65736645): Add a button to tear down the infrastructure. -->
    </mat-card>

    <mat-card class="ingest-infrastructure-unknown" *ngIf="showInfrastructureUnknown">
      <h2> <mat-icon>error</mat-icon>  The status of at least one of the items could not be retrieved.</h2>
      <p> Please reload the page to retrieve the status again. If the problem persists, please
        <a href="https://github.com/GoogleCloudPlatform/cloud-ingest/issues">
          create an issue on the project's github page.
        </a>
      </p>
      <!-- TODO(b/65736645): Add a button to tear down the infrastructure. -->
    </mat-card>

    <mat-card class="ingest-infrastructure-not-determined" *ngIf="showCouldNotDetermineInfrastructure">
      <h2> <mat-icon>error</mat-icon>  Could not determine the status of the cloud ingest infrastructure.</h2>
      <p> Please
        <a href="https://github.com/GoogleCloudPlatform/cloud-ingest/issues">
          create an issue on the project's github page.
        </a>
      </p>
      <!-- TODO(b/65736645): Add a button to tear down the infrastructure. -->
    </mat-card>

    <div class="ingest-infrastructure-buttons">
      <button class="ingest-create-infrastructure" mat-raised-button color="primary" (click)="createInfrastructure()" [disabled]="createInfrastructureDisabled">Create infrastructure</button>
      <button class="ingest-tear-down-infrastructure" mat-raised-button color="accent" (click)="tearDownInfrastructure()" [disabled]="tearDownDisabled">Tear down infrastructure</button>
    </div>

    <mat-list class="ingest-infrastructure-status-list">
      <app-infrastructure-status-item [itemName]="'Cloud Spanner'" [itemStatus]="infrastructureStatus.spannerStatus"> </app-infrastructure-status-item>
      <app-infrastructure-status-item [itemName]="'Data Control Plane'" [itemStatus]="infrastructureStatus.dcpStatus"> </app-infrastructure-status-item>
      <app-infrastructure-status-item [itemName]="'Cloud Functions'" [itemStatus]="infrastructureStatus.cloudFunctionsStatus"> </app-infrastructure-status-item>
      <app-infrastructure-status-item [itemName]="'Pubsub'" [itemStatus]="overallPubSubStatus"> </app-infrastructure-status-item>
    </mat-list>
  </ng-template>
</ng-template>
